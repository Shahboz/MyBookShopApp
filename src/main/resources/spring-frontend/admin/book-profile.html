<!--
=========================================================
* Material Dashboard 2 - v3.0.4
=========================================================
* Product Page: https://www.creative-tim.com/product/material-dashboard
* Copyright 2022 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim
=========================================================
* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/admin/head_fragment :: headFragment}"></head>

<body class="g-sidenav-show  bg-gray-200">
  <aside th:replace="~{fragments/admin/menubar_fragment :: menubarFragment('books')}"></aside>
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
    <!-- Navbar -->
    <nav th:replace="~{fragments/admin/navbar_fragment :: navbarFragment('Book')}"></nav>
    <!-- End Navbar -->
    <div class="container-fluid py-4">
      <div class="row">
        <div class="col-lg-8 mx-3 mx-md-3 mt-n4">
          <div class="card card-body">
            <div class="row">
              <div class="col-xl-3 mb-xl-0 mb-4">
                <div class="card bg-transparent shadow-xl">
                  <form id="imgForm" method="post" enctype="multipart/form-data" th:action="'/admin/books/' + ${bookInfoDto.getSlug()} + '/img/save'">
                    <div class="overflow-hidden position-relative border-radius-xl" id="uploadButton">
                      <img th:src="${bookInfoDto.getImage()}" class="position-absolute start-0 top-0 w-100 z-index-1 h-100" alt="pattern-tree">
                      <div class="card-body position-relative z-index-1 p-3">
                        <h6 class="text-center text-white mt-4 mb-5 pb-2"></h6>
                      </div>
                    </div>
                    <input type="file" name="file" id="dialog" style="display: none" accept="image/*">
                  </form>
                </div>
              </div>
              <div class="col-8 align-self-center">
                <h6 class="mb-1" th:text="${bookInfoDto.getTitle()}">Dexter the Dragon & Bumble the Bear</h6>
              </div>
            </div>
          </div>
          <div class="card mt-4" id="basic-info">
            <div class="card-header">
              <h5>Basic Info</h5>
            </div>
            <div class="card-body pt-0">
              <form method="post" th:action="@{/admin/books/edit}" th:object="${bookInfoDto}">
                <div class="row">
                  <div class="col-12 col-xl-12 text-start">
                    <div class="input-group input-group-static">
                      <label>Title</label>
                      <input type="text" class="form-control" th:field="*{title}">
                    </div>
                  </div>
                  <div class="col-12 col-xl-6">
                    <div class="card card-plain h-100">
                      <div class="card-body p-3">
                        <ul class="list-group">
                          <li class="list-group-item border-0 px-0">
                            <div class="row">
                              <div class="col-4">
                                <div class="input-group input-group-static">
                                  <label>ID</label>
                                  <input type="number" class="form-control" th:field="*{id}" readonly>
                                </div>
                              </div>
                              <div class="col-8">
                                <div class="input-group input-group-static">
                                  <label>Publication Date</label>
                                  <input type="datetime-local" class="form-control" value="2018-06-12T19:30" th:field="*{pubDate}">
                                </div>
                              </div>
                            </div>
                          </li>
                          <li class="list-group-item border-0 px-0">
                            <div class="input-group input-group-static">
                              <label>Slug</label>
                              <input type="text" class="form-control" value="Books slug" th:field="*{slug}" readonly>
                            </div>
                          </li>
                          <li class="list-group-item border-0 px-0">
                            <div class="input-group input-group-static">
                              <label>Image</label>
                              <input type="text" class="form-control" value="http://image.com" th:field="*{image}">
                            </div>
                          </li>
                          <li class="list-group-item border-0 px-0">
                            <div class="row">
                              <div class="col-6">
                                <div class="input-group input-group-static">
                                  <label>Price</label>
                                  <input type="number" class="form-control" value="300" th:field="*{price}">
                                </div>
                              </div>
                              <div class="col-6">
                                <div class="input-group input-group-static">
                                  <label>Discount</label>
                                  <input type="number" class="form-control" value="50" th:field="*{discount}" min="0" max="100">
                                </div>
                              </div>
                            </div>
                          </li>
                          <li class="list-group-item border-0 px-0">
                            <div class="form-check form-switch">
                              <label class="form-check-label" for="isBestseller">Is Bestseller</label>
                              <input class="form-check-input" type="checkbox" id="isBestseller" th:checked="${bookInfoDto.getIsBestseller()} ? 'checked'" th:field="*{isBestseller}">
                            </div>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="col-12 col-xl-6">
                    <div class="card card-plain h-100">
                      <div class="card-body">
                        <div class="input-group input-group-static">
                          <label>Description</label>
                          <textarea class="form-control" rows="11" spellcheck="false" th:field="*{description}">Description of books</textarea>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-12 text-end mt-n5">
                    <button class="btn bg-gradient-success mb-0 ms-2" type="submit" name="button">Save</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="col mx-md-3 mt-n4">
          <div class="card h-100">
            <div class="nav-wrapper position-relative end-0">
              <ul class="nav nav-pills nav-fill p-1 flex-row" role="tablist">
                <li class="nav-item" role="presentation">
                  <a class="nav-link mb-0 px-0 py-1" data-bs-toggle="tab" href="#tab1" role="tab" aria-selected="false" tabindex="-1">
                    <i class="material-icons text-lg position-relative">home</i>
                    <span class="ms-1">Genres</span>
                  </a>
                </li>
                <li class="nav-item" role="presentation">
                  <a class="nav-link mb-0 px-0 py-1 active" data-bs-toggle="tab" href="#tab2" role="tab" aria-selected="true">
                    <i class="material-icons text-lg position-relative">email</i>
                    <span class="ms-1">Tags</span>
                  </a>
                </li>
                <li class="nav-item" role="presentation">
                  <a class="nav-link mb-0 px-0 py-1" data-bs-toggle="tab" href="#tab3" role="tab" aria-selected="false" tabindex="-1">
                    <i class="material-icons text-lg position-relative">settings</i>
                    <span class="ms-1">Files</span>
                  </a>
                </li>
                <div class="moving-tab position-absolute nav-link" style="padding: 0px; transition: all 0.5s ease 0s; transform: translate3d(72px, 0px, 0px); width: 117px;">
                  <a class="nav-link mb-0 px-0 py-1 active" data-bs-toggle="tab" href="#tab2" role="tab" aria-selected="true">-</a>
                </div>
              </ul>
              <div class="tab-content card-header pb-0 p-3">
                <div role="tabpanel" class="tab-pane" id="tab1">
                  <h6 class="text-center" th:if="${#lists.isEmpty(bookInfoDto.getGenreList())}">The book has no genres</h6>
                  <div class="card" th:if="${bookInfoDto.getGenreList().size()} > 0">
                    <div class="table-responsive">
                      <table class="table align-items-center mb-0">
                        <thead>
                          <tr>
                            <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Id</th>
                            <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Root</th>
                            <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Name</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr th:each="genre : ${bookInfoDto.getGenreList()}">
                            <td><p class="text-xs font-weight-normal mb-0" th:text="${genre.getId()}">1</p></td>
                            <td><p class="text-xs font-weight-normal mb-0" th:text="${genre.getRoot()   != null ? genre.getRoot().getName() : ''}">Easy</p></td>
                            <td><p class="text-xs font-weight-normal mb-0" th:text="${genre.getName()}">Фантастика</p></td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                <div role="tabpanel" class="tab-pane active" id="tab2">
                  <h6 class="text-center" th:if="${#lists.isEmpty(bookInfoDto.getTagList())}">The book has no tags</h6>
                  <div class="card" th:if="${bookInfoDto.getTagList().size()} > 0">
                    <div class="table-responsive">
                      <table class="table align-items-center mb-0 text-center">
                        <thead>
                        <tr>
                          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Id</th>
                          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Name</th>
                          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Books count</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="tag : ${bookInfoDto.getTagList()}">
                          <td><p class="text-xs font-weight-normal mb-0" th:text="${tag.getId()}">1</p></td>
                          <td><p class="text-xs font-weight-normal mb-0" th:text="${tag.getName()}">Фантастика</p></td>
                          <td><p class="text-xs font-weight-normal mb-0" th:text="${tag.getBooks().size()}">5</p></td>
                        </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="tab3">
                  <h6 class="text-center" th:if="${#lists.isEmpty(bookInfoDto.getBookFileDtoList())}">The book has no files</h6>
                  <ul class="list-group" th:if="${bookInfoDto.getBookFileDtoList().size()} > 0">
                    <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg" th:each="fileDto : ${bookInfoDto.getBookFileDtoList()}">
                      <div class="d-flex flex-column text-sm">
                        <span class="mb-1 text-dark font-weight-bold text-sm" th:text="${fileDto.getBookFile().getHash()}">Hash file</span>
                      </div>
                      <div class="d-flex align-items-center text-sm">
                        <span th:text="${fileDto.getFileSize()} + ' KB'"></span>
                        <button class="btn btn-link text-dark text-sm mb-0 px-0 ms-4">
                          <i class="material-icons text-lg position-relative me-1"
                             th:text="${fileDto.getBookFile().getType().getName()} == 'PDF' ? 'picture_as_pdf' :
                                (${fileDto.getBookFile().getType().getName()} == 'EPUB' ? 'auto_stories' : 'filter_none')">picture_as_pdf</i>
                          <span th:text="' ' + ${fileDto.getBookFile().getType().getName()}"></span>
                        </button>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- mx-3 mx-md-4 mt-n4-->
      <div class="row mx-md-2">
        <div class="col-md-7 mt-4">
          <div class="card">
            <div class="card-header pb-0 px-3">
              <h6 class="mb-0">Reviews</h6>
            </div>
            <div class="card-body pt-4 p-3">
              <h6 class="text-center" th:if="${#lists.isEmpty(bookInfoDto.getBookReviewDtoList())}">The book has no reviews</h6>
              <ul class="list-group" th:if="${bookInfoDto.getBookReviewDtoList().size()} > 0">
                <li class="list-group-item border-0 d-flex p-4 mb-2 bg-gray-100 border-radius-lg" th:each="reviewDto : ${bookInfoDto.getBookReviewDtoList()}">
                  <div class="d-flex flex-column">
                    <span class="mb-2 text-xs">Reviewer: <span class="text-dark ms-sm-2 font-weight-bold" th:text="${reviewDto.getReview().getUser().getName()}">Reviewer</span></span>
                    <span class="mb-2 text-xs">Datetime: <span class="text-dark ms-sm-2 font-weight-bold" th:text="${reviewDto.getReview().getTime()}">2018-06-12T19:30</span></span>
                    <span class="mb-2 text-xs">Rate: <span class="text-dark ms-sm-2 font-weight-bold" th:text="${reviewDto.getRate().getValue()}">5</span></span>
                    <span class="mb-2 text-xs">Likes count: <span class="text-dark ms-sm-2 font-weight-bold" th:text="${reviewDto.getLikedCount()}">5</span></span>
                    <span class="mb-2 text-xs">Dislikes count: <span class="text-dark ms-sm-2 font-weight-bold" th:text="${reviewDto.getDislikedCount()}">5</span></span>
                  </div>
                  <div class="ms-auto text-end">
                    <a class="btn btn-link text-danger text-gradient px-3 mb-0"
                       th:href="@{'/admin/books/review/delete?book=' + ${bookInfoDto.getSlug()} + '&id=' + ${reviewDto.getReview().getId()}}">
                      <i class="material-icons text-sm me-2">delete</i>Delete
                    </a>
                    <!--<a class="btn btn-link text-dark px-3 mb-0" href="javascript:;">
                      <i class="material-icons text-sm me-2">edit</i>Edit
                    </a>-->
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-md-5 mt-4">
          <div class="card">
            <div class="card-header pb-0 px-3">
              <div class="row">
                <div class="col-md-6">
                  <h6 class="mb-0">Authors</h6>
                </div>
                <div class="w-50 text-end">
                  <button class="btn bg-gradient-success mb-0 ms-0" type="button" name="button" data-bs-toggle="modal" data-bs-target="#addAuthorModal">Add author</button>
                  <div class="col-md-4">
                    <div class="modal fade" id="addAuthorModal" tabindex="-1" role="dialog" aria-labelledby="addAuthorModal" aria-hidden="true">
                      <div class="modal-dialog modal-dialog-centered" role="document">
                        <form method="post" th:action="@{'/admin/books/author/add'}" th:object="${authorBookDto}">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h6 class="modal-title font-weight-normal" id="addAuthorModalLabel">Select author</h6>
                              <button type="button" class="btn-close text-dark" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                              </button>
                            </div>
                            <div class="modal-body">
                              <div class="input-group input-group-static mb-4 is-valid">
                                <input type="text" class="form-control" th:value="${bookInfoDto.getSlug()}" name="bookSlug" hidden>
                                <select class="form-control" id="selectAuthor" th:field="*{authorSlug}">
                                  <option th:each="author : ${authorList}" th:text="${author.getName()}" th:value="${author.getSlug()}">Author1</option>
                                </select>
                              </div>
                            </div>
                            <div class="modal-footer">
                              <button type="submit" class="btn bg-gradient-success">Add</button>
                              <button type="button" class="btn bg-gradient-secondary" data-bs-dismiss="modal">Cancel</button>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-body pt-4 p-3">
              <h6 class="text-center" th:if="${#lists.isEmpty(bookInfoDto.getAuthorBooksList())}">The book has no author</h6>
              <ul class="list-group" th:if="${bookInfoDto.getAuthorBooksList().size()} > 0">
                <li class="list-group-item border-0 d-flex align-items-center px-0 mb-2 pt-0" th:each="authorBook : ${bookInfoDto.getAuthorBooksList()}">
                  <div class="avatar me-3">
                    <img th:src="${authorBook.getAuthor().getPhoto()}" alt="kal" class="border-radius-lg shadow">
                  </div>
                  <div class="d-flex align-items-start flex-column justify-content-center">
                    <h6 class="mb-0 text-sm" th:text="${authorBook.getAuthor().getName()}">Sophie B.</h6>
                  </div>
                  <a class="btn btn-link pe-3 ps-0 mb-0 ms-auto w-25 w-md-auto"
                     th:href="@{'/admin/books/author/delete?book=' + ${bookInfoDto.getSlug()} + '&id=' + ${authorBook.getId()}}">Delete</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <!-- mx-3 mx-md-4 mt-n4-->
      <div class="card mx-md-3 mt-4" id="delete">
        <div class="modal fade" id="modal-notification" tabindex="-1" aria-labelledby="modal-notification" style="display: none;" aria-hidden="true">
          <div class="modal-dialog modal-danger modal-dialog-centered modal-" role="document">
            <div class="modal-content">
              <form method="post" th:action="@{/admin/books/delete}" th:object="${bookInfoDto}">
                <div class="modal-header">
                  <h6 class="modal-title font-weight-normal text-warning" id="modal-title-notification">Your attention is required</h6>
                  <button type="button" class="btn-close text-dark" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                  </button>
                </div>
                <div class="modal-body">
                  <div class="py-3 text-center">
                    <i class="material-icons text-6xl">notifications_active</i>
                    <h4 class="text-gradient text-danger mt-4">Are you sure want to delete the book?</h4>
                    <p>All links associated with the book will also be deleted: files, reviews, ratings, linking books to users, information about file downloads.</p>
                    <i>Keep in mind, only unsold books can be deleted!</i>
                    <input type="text" class="form-control" th:value="${bookInfoDto.getSlug()}" name="bookSlug" hidden>
                  </div>
                </div>
                <div class="modal-footer text-end">
                  <button type="submit" class="btn btn-secondary">Yes</button>
                  <button type="button" class="btn btn-link ml-auto" data-bs-dismiss="modal">Cancel</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="d-flex align-items-center mb-sm-0 mb-4">
            <div class="w-50">
              <h5>Delete Book</h5>
              <p class="text-sm mb-0">Once you delete book, all related links (reviews, rates, files and etc.) is deleted and there is no going back. Please be certain!</p>
            </div>
            <div class="w-50 text-end">
              <button class="btn bg-gradient-danger mb-0 ms-2" type="button" name="button" data-bs-toggle="modal" data-bs-target="#modal-notification">Delete Book</button>
            </div>
          </div>
        </div>
      </div>
      <footer th:replace="~{fragments/admin/footer_fragment :: footerFragment}"></footer>
    </div>
  </main>
  <div th:replace="~{fragments/admin/configurator :: configuratorFragment}"></div>
  <script src="/assets/plg/jQuery/jquery-3.5.1.min.js"></script>
  <script src="/assets/js/UploadNewBookImageScript.js"></script>
  <th:block th:replace="~{fragments/admin/scripts :: scriptFragment}"></th:block>
</body>

</html>